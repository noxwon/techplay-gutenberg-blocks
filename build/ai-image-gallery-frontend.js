(()=>{"use strict";var e={n:o=>{var t=o&&o.__esModule?()=>o.default:()=>o;return e.d(t,{a:t}),t},d:(o,t)=>{for(var n in t)e.o(t,n)&&!e.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:t[n]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o)};const o=window.jQuery;var t=e.n(o);function n(e){return"string"!=typeof e?e:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function a(e){console.log("[Hover Actions] Initializing for gallery:",e);var o=e.querySelectorAll(".gallery-item");console.log("[Hover Actions] Found ".concat(o.length," items")),o.forEach((function(e,o){var a=e.querySelector(".image-info-icon"),i=e.querySelector(".copy-url-button"),l=e.querySelector(".download-image-button"),r=e.querySelector("img");console.log("[Hover Actions] Item ".concat(o,": InfoBtn:"),a,"CopyBtn:",i,"DlBtn:",l,"Img:",r),a?(console.log("[Hover Actions] Item ".concat(o,": Adding click listener to infoButton")),a.addEventListener("click",(function(e){console.log("[Hover Actions] Item ".concat(o,": Info button clicked!")),e.stopPropagation(),function(e,o){var a=t()("#ai-gallery-info-modal");0===a.length&&(console.log("[Info Modal] Creating modal element."),t()("body").append('\n            <div id="ai-gallery-info-modal" class="ai-image-modal" style="display: none;">\n                <div class="modal-content">\n                    <button class="close-button" title="Close">&times;</button>\n                    <div class="image-meta"></div>\n                </div>\n            </div>\n        '),(a=t()("#ai-gallery-info-modal")).on("click",(function(e){(t()(e.target).is(a)||t()(e.target).closest(".close-button").length)&&(console.log("[Info Modal Close] Closing via click."),a.fadeOut(300))})),console.log("[Info Modal] Close handlers attached."));var i=a.find(".image-meta"),l="<h3>Image Generation Details</h3>",r=function(e,o){var t={positive:o||"",negative:"",params:{}};if(!e||"string"!=typeof e)return t;try{var n=e.replace(/&quot;/g,'"');if(n.trim().startsWith("{")&&n.trim().endsWith("}")){var a=JSON.parse(n);return t.positive=a.prompt||t.positive,t.negative=a.negativePrompt||"",t.params=a,delete t.params.prompt,delete t.params.negativePrompt,console.log("[Parser] Parsed parameters as JSON:",t),t}}catch(e){console.warn("[Parser] Failed to parse parameters as JSON, falling back to text:",e)}var i=e.split("\n"),l="positive",r="";if(t.positive&&(l="params"),i.forEach((function(e){var o=e.trim();o&&(o.startsWith("Negative prompt:")?(t.negative=o.substring(16).trim(),l="negative"):o.includes(":")&&o.match(/^Steps: \d+, Sampler: .+/)?(r=o,l="params"):"negative"===l?t.negative+=" "+o:"positive"===l?t.positive+=(t.positive?"\n":"")+o:"params"===l&&(r+=", "+o))})),r)for(var s,c=/(\w+(?:\s+\w+)*?):\s*("[^"\\]*(?:\\.[^"\\]*)*"|[^,]+(?:,\s*(?![A-Za-z\s]+:))?)/g;null!==(s=c.exec(r));){var d=s[1].trim(),g=s[2].trim();g.endsWith(",")&&(g=g.slice(0,-1).trim()),g.startsWith('"')&&g.endsWith('"')&&(g=g.slice(1,-1)),t.params[d]=g}return t.positive=t.positive.trim(),t.negative=t.negative.trim(),console.log("[Parser] Parsed as Text (v5):",t),t}(e,o);r.positive&&(l+='<div class="meta-section"><h4>Positive Prompt</h4><div class="prompt-box positive"><p>'.concat(n(r.positive),"</p></div></div>")),r.negative&&(l+='<div class="meta-section"><h4>Negative Prompt</h4><div class="prompt-box negative"><p>'.concat(n(r.negative),"</p></div></div>"));var s=Object.keys(r.params);if(s.length>0?(l+='<div class="meta-section generation-details-section"><h4>Parameters</h4>',s.forEach((function(e){"prompt"!==e.toLowerCase()&&"negative prompt"!==e.toLowerCase()&&(l+="<p><strong>".concat(n(e),":</strong> ").concat(n(r.params[e]),"</p>"))})),l+="</div>"):r.positive||r.negative||(l+='<div class="meta-section generation-details-section"><h4>Parameters</h4><p>No specific parameters found.</p></div>'),r.params["Civitai resources"]&&"string"==typeof r.params["Civitai resources"])try{var c=JSON.parse(r.params["Civitai resources"].replace(/&quot;/g,'"'));Array.isArray(c)&&(l+='<div class="meta-section civitai-resources-section"><h4>Civitai Resources</h4>',c.forEach((function(e){l+="<p><strong>Type:</strong> ".concat(n(e.type||"N/A"),", "),e.modelName&&e.modelVersionName?l+="<strong>Name:</strong> ".concat(n(e.modelName)," (").concat(n(e.modelVersionName),"), "):e.modelName&&(l+="<strong>Name:</strong> ".concat(n(e.modelName),", ")),void 0!==e.weight&&(l+="<strong>Weight:</strong> ".concat(n(e.weight))),l+="</p>"})),l+="</div>")}catch(e){console.error("Error parsing Civitai resources:",e),l+='<div class="meta-section civitai-resources-section"><h4>Civitai Resources (Raw)</h4><pre>'.concat(n(r.params["Civitai resources"]),"</pre></div>")}i.html(l),console.log("[displayInfoModal] HTML set. Fading in..."),a.css("display","flex").hide().fadeIn(300)}(r.dataset.parameters,r.dataset.prompt)}))):console.log("[Hover Actions] Item ".concat(o,": Info button not found.")),i&&r?(console.log("[Hover Actions] Item ".concat(o,": Adding click listener to copyButton")),i.addEventListener("click",(function(e){console.log("[Hover Actions] Item ".concat(o,": Copy button clicked!")),e.stopPropagation();var t=r.dataset.largeSrc||r.src;navigator.clipboard.writeText(t).then((function(){i.classList.add("copied"),setTimeout((function(){return i.classList.remove("copied")}),1500)})).catch((function(e){console.error("Failed to copy URL: ",e)}))}))):console.log("[Hover Actions] Item ".concat(o,": Copy button or image not found.")),l&&r?(console.log("[Hover Actions] Item ".concat(o,": Adding click listener to downloadButton")),l.addEventListener("click",(function(e){console.log("[Hover Actions] Item ".concat(o,": Download button clicked!")),e.stopPropagation();var t=r.dataset.largeSrc||r.src,n=document.createElement("a");n.href=t;var a=t.substring(t.lastIndexOf("/")+1).split("?")[0]||"download.jpg";n.download=a,document.body.appendChild(n),n.click(),document.body.removeChild(n)}))):console.log("[Hover Actions] Item ".concat(o,": Download button or image not found."))}))}console.log("[AI Gallery Frontend] Script Parsed (Top Level)"),console.log("[AI Gallery Frontend] Reached Global Scope Test Point 1"),document.addEventListener("DOMContentLoaded",(function(){console.log("[AI Gallery Frontend] Script Loaded");var e=document.querySelectorAll(".wp-block-techplay-gutenberg-blocks-ai-image-gallery");console.log("[AI Gallery Frontend] Found ".concat(e.length," gallery elements.")),e.forEach((function(e,o){console.log("[AI Gallery Frontend] Loop ".concat(o,": Processing gallery element:"),e);try{var t=e.classList.contains("has-masonry-layout");console.log("[Masonry Check] Is Masonry enabled for this gallery?",t),t?(console.log("[Masonry Check] Initializing Masonry for:",e),imagesLoaded(e,(function(o){if(console.log("[imagesLoaded] All images loaded for gallery:",e,"Instance:",o),e.classList.contains("has-masonry-layout")){var t=new Masonry(e,{itemSelector:".gallery-item",percentPosition:!0,gutter:parseInt(getComputedStyle(e).getPropertyValue("--gap"),10)||0});console.log("[Masonry Init] Masonry instance created (WITH gutter option):",t),t.layout(),console.log("[Masonry Init] Masonry layout forced.")}else console.log("[imagesLoaded] Masonry was disabled before initialization could complete.",e)}))):console.log("[Masonry Check] Masonry not enabled for gallery (no .has-masonry-layout class found in JS).",e),function(e){if(e.classList.contains("has-lightbox")){var o=document.getElementById("ai-gallery-lightbox-modal");o||((o=document.createElement("div")).id="ai-gallery-lightbox-modal",o.innerHTML='\n            <div class="modal-content">\n                <figure>\n                    <img src="" alt="" id="lightbox-image">\n                </figure>\n                <button class="close-button" title="Close lightbox">\n                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="18" height="18">\n                        <path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z" />\n                     </svg>\n                </button>\n            </div>\n        ',o.querySelector(".close-button").addEventListener("mousedown",(function(e){e.stopPropagation(),console.log("[Listener Debug] Lightbox CLOSE BUTTON mousedown!"),o.style.display="none"})),o.addEventListener("mousedown",(function(e){console.log("[Listener Debug] Lightbox OVERLAY mousedown (target, modal): ",e.target,o),e.target===o&&(o.style.display="none")})),document.body.appendChild(o));var t=o.querySelector("#lightbox-image");e.querySelectorAll(".gallery-item img").forEach((function(e){e.style.cursor="pointer",e.addEventListener("click",(function(e){if(!e.target.closest("button")){var n=e.target.dataset.largeSrc||e.target.src,a=e.target.alt||"";t.src=n,t.alt=a,o.style.display="flex",console.log("[Lightbox] Image clicked, opening via style.")}}))}))}}(e),console.log("[Init Functions] Called initializeLightbox for gallery ".concat(o)),a(e),console.log("[Init Functions] Called initializeHoverActions for gallery ".concat(o))}catch(o){console.error("[AI Gallery Frontend] Error processing gallery:",e,o)}})),function(){var e=document.getElementById("ai-gallery-info-modal");if(e&&!e.dataset.closeHandlerAttached){console.log("[Info Modal] Attaching close handlers.");var o=e.querySelector(".close-button");o&&o.addEventListener("mousedown",(function(o){o.stopPropagation(),console.log("[Listener Debug] Info Modal CLOSE BUTTON mousedown!"),e.style.display="none"})),e.addEventListener("mousedown",(function(o){console.log("[Listener Debug] Info Modal OVERLAY mousedown (target, modal): ",o.target,e),o.target===e&&(e.style.display="none")})),e.dataset.closeHandlerAttached="true"}else e?console.log("[Info Modal] Close handlers already attached."):console.error("[Info Modal] Cannot attach close handlers, modal not found.")}(),console.log("[AI Gallery Frontend] Finished processing all galleries.")})),console.log("[AI Gallery Frontend] Reached Global Scope Test Point 2")})();
//# sourceMappingURL=ai-image-gallery-frontend.js.map